# Load necessary library
library(dplyr)




# Step 1: Simulate Restaurant Data
set.seed(321)
# Simulating a dataset for restaurant orders and customer feedback
restaurant_data <- data.frame(
  date = seq.Date(Sys.Date() - 19, Sys.Date(), by = "day"),
  order_id = 1:20,
  customer_id = sample(1:10, 20, replace = TRUE),
  menu_item = sample(c("Burger", "Pizza", "Pasta", "Salad", "Sushi", "Soup"), 20, replace = TRUE),
  quantity = sample(1:3, 20, replace = TRUE),
  price_per_item = rep(c(10, 12, 8, 6, 15, 5), length.out = 20),
  feedback_score = sample(1:5, 20, replace = TRUE)  # Customer feedback score (1–5)
)
# Add a total price column for each order
restaurant_data$total_price <- restaurant_data$quantity * restaurant_data$price_per_item
# View the restaurant data
print(restaurant_data)





# Step 2: Continuous Query – Track Total Sales Per Day
continuous_sales_query <- function(data, interval = 5, duration = 20) {
  start_time <- Sys.time()
  
  repeat {
    current_time <- Sys.time()
    
    # Get sales data for the last 7 days
    recent_data <- data %>%
      filter(date >= Sys.Date() - 7)  # Last 7 days
    
    # Calculate total sales for each day
    sales_per_day <- recent_data %>%
      group_by(date) %>%
      summarise(total_sales = sum(total_price))
    
    cat("Continuous Query run at:", format(current_time, "%H:%M:%S"), "\n")
    cat("Total Sales in the Last 7 Days:\n")
    print(sales_per_day)
    
    Sys.sleep(interval)
   
    if (as.numeric(difftime(current_time, start_time, units = "secs")) > duration)
      break
  }
}




# Step 3: Ad-Hoc Query – Most Popular Menu Items
ad_hoc_popular_items_query <- function(data) {
  popular_items <- data %>%
    group_by(menu_item) %>%
    summarise(total_orders = n()) %>%
    arrange(desc(total_orders))
  
  return(popular_items)
}





# Step 4: One-Time Query – High-Rated Orders
one_time_high_ratings_query <- function(data) {
  high_rated_orders <- data %>%
    filter(feedback_score >= 4)
  
  return(high_rated_orders)
}






# Step 5: Run the Queries
cat("Running Continuous Sales Query...\n")
continuous_sales_query(restaurant_data, interval = 5, duration = 20)

cat("\nAd-hoc Query: Most Popular Menu Items\n")
print(ad_hoc_popular_items_query(restaurant_data))

cat("\nOne-Time Query: High-Rated Orders\n")
print(one_time_high_ratings_query(restaurant_data))
